## 1. 进程与线程

### 1.1 进程与线程的区别

进程：**进程是一个正在执行程序的实例，拥有自己的程序计数器和内部状态，是系统进行资源分配和调度的一个独立单位**（具有动态、并发、独立、异步的特性，以及就绪、执行、阻塞3种状态，资源拥有单位等属性）；引入进程是为了使多个程序可以并发的执行，以提高系统的资源利用率和吞吐量。

线程：是比进程更小的可独立运行的基本单位，可以看做是**轻量级的进程**（具有轻型实体，独立调度分派单位，可并发执行，**共享进程资源**等属性）；引入目的是为了减少程序在并发执行过程中的开销，使OS的并发效率更高。

两者的对比：

1. 调度方面：在引入线程的OS中，线程是独立的调度和分派单位，而进程作为资源的拥有单位(相当于把未引入线程的传统OS中的进程的两个属性分开了)。**由于线程不拥有资源，因此可以显著的提高并发度以及减少切换开销**。
2. 并发性：引入了线程的OS中，进程间可以并发，而且一个进程内部的多个线程之间也是可以并发的，这就使OS具有更好的并发性，有效的提高了系统资源利用率和吞吐量。
3. 拥有资源：处于安全和方便管理的因素，一个进程往往会**独占一些资源，如地址空间、全局变量、打开的文件、子进程、信号和账户信息**等；而为了处理各自的任务，线程也会独占一些资源，如**栈、寄存器、程序计数器**和状态等。
4. 系统开销：创建或者撤销进程的时候，系统要为之创建或回收PCB，系统资源等，切换时也需要保存和恢复CPU环境。而线程的切换只需要保存和恢复少量的寄存器，不涉及存储器管理方面的工作，所以开销较小。此外，**统一进程中的多个线程由于共享地址空间**，所以通信同步等都比较方便。

**进程中线程共享的资源：地址空间、全局变量、打开文件、子进程、信号与信号处理程序、账户信息。**

**进程中线程独占的资源：程序计数器、寄存器、堆栈、状态。**

### 1.2 进程的实现与状态

为实现进程模型，操作系统维护着一个结构体数组，即进程表（process table）。每个进程占用一个进程表项，该表项包含了进程状态的重要信息，包括程序计数器、堆栈指针、优先级、信号、内存分配状况（正文段指针、数据段指针、堆栈段指针）、所打开文件的状态，以及其他在进程由运行态转换到阻塞态时必须保存的信息。从而保证该进程随后能再次启动，就像从未被中断过一样。

进程拥有三种状态：

1. 运行态，此时进程正占用着CPU；
2. 就绪态，进程处于可运行状态，但因为其他进程正在运行而暂时停止；
3. 阻塞态，除非外部事件发生，否则进程不能运行。

进程的三种状态之间有四种可能的转换关系，如图所示：

![image-20201028001025332](https://markdown-wq-1302077921.cos.ap-guangzhou.myqcloud.com/PicGoimage-20201028001025332.png)

当一个进程从管道或设备文件读数据（如终端）读数据时，如果没有有效的输入存在，则进程会被自动阻塞。当进程收到有效输入时，则会从阻塞态转换到就绪态。如果此时没有其他进程运行，则立即从就绪态转换到运行态。

### 1.3 线程的实现方式

